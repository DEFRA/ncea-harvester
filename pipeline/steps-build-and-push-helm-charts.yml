steps:

- task: HelmDeploy@0
  condition: and(succeeded(), eq(variables['ACR.Deploy'], 'true'))
  inputs:
    command: package
    chartPath: $(chartPath)
    chartVersion: $(Build.SourceBranchName)
    arguments: '--app-version $(Build.SourceBranchName)'
    destination: $(Build.ArtifactStagingDirectory)

- task: AzureCLI@1
  condition: and(succeeded(), eq(variables['ACR.Deploy'], 'true'))
  inputs:
    azureSubscription: $(ACR.ServiceConnection)
    scriptLocation: inlineScript
    inlineScript: az acr helm push -n $(acrName) $(Build.ArtifactStagingDirectory)/$(ACR.ContainerRepository)-$(Build.BuildId).tgz